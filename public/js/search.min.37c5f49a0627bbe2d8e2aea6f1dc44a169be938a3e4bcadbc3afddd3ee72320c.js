(function(){"use strict";const t=document.querySelector("[data-search-modal]"),h=document.querySelectorAll('[data-target="search-modal"]'),r=document.querySelector("[data-search-close]"),n=document.getElementById("search-input"),e=document.getElementById("search-results"),s=document.getElementById("search-placeholder");if(!t)return;let c,l,o=!1,d;function m(e){return new Promise((t,n)=>{const s=document.createElement("script");s.src=e,s.onload=t,s.onerror=n,document.head.appendChild(s)})}async function f(){if(o)return;try{if(typeof Fuse=="undefined"){if(!window.fuseJSSrc)throw new Error("Fuse.js library source URL not provided via window.fuseJSSrc");await m(window.fuseJSSrc)}if(!window.searchIndexURL)throw new Error("Search index URL not provided via window.searchIndexURL");const e=await fetch(window.searchIndexURL);if(!e.ok)throw new Error("Search index not found at "+window.searchIndexURL);l=await e.json();const t={keys:[{name:"title",weight:1},{name:"description",weight:.4},{name:"content",weight:.2},{name:"tags",weight:.4},{name:"categories",weight:.4}],includeMatches:!0,minMatchCharLength:2,threshold:.2,sortFn:(e,t)=>e.score!==t.score?e.score-t.score:e.item.priority!==t.item.priority?e.item.priority-t.item.priority:e.refIndex-t.refIndex};c=new Fuse(l,t),o=!0,console.log("Fuse.js initialized.")}catch(e){console.error("Failed to initialize Fuse.js:",e)}}const u=()=>{t.classList.remove("hidden"),t.classList.add("flex"),n.focus(),document.body.style.overflow="hidden",f()},i=()=>{t.classList.add("hidden"),t.classList.remove("flex"),n.value="",e.innerHTML="",s&&e.appendChild(s),document.body.style.overflow=""};h.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),u()})}),r&&r.addEventListener("click",i),t.addEventListener("click",e=>{e.target===t&&i()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&!t.classList.contains("hidden")&&i(),(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),u())}),n&&n.addEventListener("input",()=>{clearTimeout(d),d=setTimeout(()=>{if(!o){e.innerHTML='<div class="text-center text-gray-500 py-4">Initializing search...</div>';return}const t=n.value.trim();if(t.length<2){e.innerHTML="",s&&e.appendChild(s);return}typeof gtag=="function"&&(gtag("event","search",{search_term:t}),console.log(`GA Event sent: search, search_term: ${t}`));const i=c.search(t,{limit:20});p(i,t)},500)});function p(t,n){if(e.innerHTML="",t.length===0){e.innerHTML=`<div class="text-center text-gray-500 py-4">No results found for "${n}"</div>`;return}const s=document.createElement("ul");s.className="divide-y divide-border dark:divide-darkmode-border",t.forEach(({item:e,matches:t})=>{const o=document.createElement("li");o.className="p-4 hover:bg-theme-light dark:hover:bg-darkmode-theme-dark/50 rounded-md";let i=e.title,n=e.description||(e.content?e.content.substring(0,150)+"...":"");const r=t.find(e=>e.key==="title");r&&(i=a(i,r.indices));const c=t.find(e=>e.key==="description");if(c)n=a(n,c.indices);else{const s=t.find(e=>e.key==="content");if(s&&e.content){const t=Math.max(0,s.indices[0][0]-30),o=Math.min(e.content.length,s.indices[0][1]+30);let i=e.content.substring(t,o);const r=s.indices.map(([e,n])=>[e-t,n-t]);n=(t>0?"...":"")+a(i,r)+(o<e.content.length?"...":"")}}o.innerHTML=`
        <a href="${e.permalink}" class="block">
          <h4 class="text-lg font-semibold text-primary dark:text-darkmode-primary">${i}</h4>
          <p class="text-sm text-text dark:text-darkmode-text mt-1">${n}</p>
        </a>
      `,s.appendChild(o)}),e.appendChild(s)}function a(e,t){if(!e)return"";let n="",s=0;return t.forEach(([t,o])=>{n+=e.substring(s,t),n+=`<mark class="bg-fuchsia-200/75 dark:bg-fuchsia-500/50 rounded px-1 py-0.5">${e.substring(t,o+1)}</mark>`,s=o+1}),n+=e.substring(s),n}})()