{{ define "main" }}
{{ partial "page-header" . }}

<section class="section pt-6 mt-0 pb-16">
  <div class="container">

    <div>
      {{ partial "components/content-contribute-cta.html" (dict
      "icon" "solid people-group"
      "title" "Join the <span class=\"gradient-text\">Conversation</span>"
      "description" "The Application Lab Community thrives on collaboration. Join our WhatsApp Group, attend an event, or contribute to the blog to help students achieve their goals."
      "link" "https://chat.whatsapp.com/JgONfqufJQlKl53XPAddIM?mode=ac_t"
      "link_text" "Join Out Whatsapp Community"
      ) }}
    </div>
    {{/* Display the main content of the _index.md page */}}
    <div class="content text-center mb-12 prose dark:prose-invert max-w-none">
        {{ .Content }}
    </div>

    {{/* Display the new guide cards */}}
    <div class="row gx-5 gy-8 mb-16">
      {{ range .Params.sections }}
        <div class="{{ .column }} mb-6 last:mb-0 md:mb-0">
          {{/* Updated partial call to pass page_context */}}
          {{ partial "components/guide-card.html" (dict
              "title" .title
              "url" .url
              "icon" .icon
              "description" .description
              "key_areas" .key_areas
              "cta_text" .cta_text
              "page_context" $.Page
          )}}
        </div>
      {{ end }}
    </div>

    {{/* --- New Modern Recent Events Sections --- */}}
    {{/* Recent Workshops Section */}}
    {{ $workshops_all := where site.RegularPages "Section" "workshops" }}
    {{ $workshops_sorted := partial "logic/get_past_events.html" $workshops_all }}
    {{ partial "custom/modern-recent-events-section.html" (dict
        "section_title" "Workshops"
        "section_subtitle" "Catch up on our latest expert-led sessions and community discussions."
        "events_list" $workshops_sorted
        "view_all_link" "/workshops/"
        "view_all_text" "View All Workshops"
        "page_context" .
      )
    }}

    <!-- Recent Posts -->
    <div class="mb-0">
      <h3 class="section-title text-3xl font-semibold mb-3">Blog</h3>
      <p class="section-subtitle text-lg text-gray-600 dark:text-gray-400 mb-8 mx-auto">Stay informed with our latest articles, tutorials, and community updates.</p>
      <div class="row"> <!-- Kept row for 3-column layout for blogs -->
        {{ $blog_posts := where .Site.RegularPages "Section" "blog" }}
        {{ $sorted_blog_posts := sort $blog_posts "Date" "desc" }}
        {{ range first 3 $sorted_blog_posts }}
          <div class="md:col-6 lg:col-4 mb-14"> <!-- Changed md:col-12 to md:col-6 for better md layout -->
            {{ partial "components/blog-card" . }}
          </div>
        {{ end }}
      </div>
      <div class="text-center mt-8"> <!-- Centered "View All Posts" button -->
         <a href="{{ "blog/" | relLangURL }}" class="btn btn-new-primary">View All Posts</a>
      </div>
    </div>
  </div>
</section>
{{ end }}
